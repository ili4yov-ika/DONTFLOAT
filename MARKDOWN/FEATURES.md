# Функциональность DONTFLOAT

## Обзор возможностей

DONTFLOAT - это мощный аудиоанализатор и корректор BPM с поддержкой как GUI, так и консольного режима работы.

## Основные функции

### 1. Анализ BPM

#### Алгоритмы анализа
- **Базовый алгоритм**: Стандартный анализ ритма
- **Алгоритм Mixxx**: Продвинутый анализ с использованием алгоритмов Mixxx
- **Быстрый анализ**: Ускоренный режим для предварительной оценки
- **Переменный темп**: Поддержка треков с изменяющимся темпом

#### Параметры анализа
- **Минимальный BPM**: 60 (по умолчанию)
- **Максимальный BPM**: 200 (по умолчанию)
- **Фиксированный темп**: Предположение о постоянном темпе
- **Детекция битов**: Автоматическое определение битов

#### Результаты анализа
- Определенный BPM
- Уровень уверенности (%)
- Количество обнаруженных битов
- Статус фиксированного темпа
- Обнаружение нерегулярных битов
- Среднее отклонение ритма

### 2. Визуализация аудио

#### WaveformView
- **Отображение звуковой волны**: Визуализация аудиосигнала
- **Масштабирование**: Зум для детального просмотра
- **Навигация**: Прокрутка по временной шкале
- **Метки цикла**: Установка точек A и B для зацикливания
- **Позиция воспроизведения**: Отображение текущей позиции

#### PitchGridWidget
- **Сетка высот**: Отображение нотной сетки
- **Синхронизация**: Синхронизация с WaveformView
- **Адаптивное масштабирование**: Автоматическая адаптация к масштабу
- **Метки нот**: Отображение нотных меток

### 3. Воспроизведение аудио

#### Управление воспроизведением
- **Play/Pause**: Воспроизведение и пауза
- **Stop**: Остановка воспроизведения
- **Позиционирование**: Переход к определенной позиции
- **Зацикливание**: Воспроизведение между точками A и B

#### Поддерживаемые форматы
- **WAV**: Без потерь качества
- **MP3**: Сжатый формат
- **FLAC**: Сжатие без потерь
- **Частота дискретизации**: 44.1 kHz (рекомендуется)
- **Битность**: 16-bit, 24-bit, 32-bit
- **Каналы**: Моно, Стерео

### 4. Метроном

#### Настройки метронома
- **Громкость**: Регулировка громкости звука
- **Тип звука**: Различные звуки для битов
- **BPM**: Синхронизация с темпом трека
- **Размер такта**: Настройка размера такта (4/4, 3/4, 2/4, 6/8)

#### Функции метронома
- **Включение/выключение**: Переключение метронома
- **Синхронизация**: Автоматическая синхронизация с BPM
- **Визуальные индикаторы**: Отображение битов

### 5. Анализ тональности

#### KeyAnalyzer
- **Определение тональности**: Автоматическое определение тональности
- **Мажорные тональности**: Поддержка мажорных тональностей
- **Минорные тональности**: Поддержка минорных тональностей
- **Интеграция с qm-dsp**: Использование библиотеки qm-dsp

## Консольный режим

### Командная строка

```bash
# Базовый анализ
DONTFLOAT.exe -c -f <файл>

# Анализ с алгоритмом Mixxx
DONTFLOAT.exe -c -f <файл> --mixxx

# Анализ с параметрами
DONTFLOAT.exe -c -f <файл> --min-bpm 70 --max-bpm 90

# Переменный темп
DONTFLOAT.exe -c -f <файл> --variable-tempo

# Быстрый анализ
DONTFLOAT.exe -c -f <файл> --fast
```

### Опции командной строки

- **-c, --console**: Запуск в консольном режиме
- **-f, --file**: Путь к аудиофайлу для анализа
- **--min-bpm**: Минимальный BPM для анализа (по умолчанию: 60)
- **--max-bpm**: Максимальный BPM для анализа (по умолчанию: 200)
- **--mixxx**: Использовать алгоритм Mixxx
- **--fast**: Быстрый анализ
- **--variable-tempo**: Предполагать переменный темп

### Пример вывода

```
=== Консольный режим DONTFLOAT ===
Анализ файла: example.mp3
Примечание: Используются синтетические данные для демонстрации
Загрузка аудиофайла...
Файл загружен успешно:
  - Размер: 220500 сэмплов
  - Частота дискретизации: 44100 Hz
  - Длительность: 5 секунд

Настройки анализа:
  - Минимальный BPM: 60
  - Максимальный BPM: 200
  - Использовать алгоритм Mixxx: Да
  - Предполагать фиксированный темп: Да
  - Быстрый анализ: Нет

Начинаем анализ BPM...

=== РЕЗУЛЬТАТЫ АНАЛИЗА ===
Определенный BPM: 80.5
Уверенность: 85%
Количество обнаруженных битов: 25
Фиксированный темп: Да
Нерегулярные биты: Нет
Среднее отклонение: 3.2%

Первые 10 битов:
[детальная таблица]

=== АНАЛИЗ ЗАВЕРШЕН ===
```

## Интерфейс пользователя

### Темы оформления

#### Темная тема (по умолчанию)
- **Окно**: `#353535` (темно-серый)
- **Текст**: `#ffffff` (белый)
- **База**: `#232323` (очень темно-серый)
- **Кнопки**: `#353535` (темно-серый)
- **Выделение**: `#2a82da` (синий)

#### Светлая тема
- **Окно**: `#f0f0f0` (светло-серый)
- **Текст**: `#000000` (черный)
- **База**: `#ffffff` (белый)
- **Кнопки**: `#f0f0f0` (светло-серый)
- **Выделение**: `#0078d7` (синий)

### Навигация

#### Горячие клавиши
- **Пробел**: Воспроизведение/пауза
- **S**: Остановка
- **T**: Метроном
- **A/B**: Установка меток цикла
- **Shift+A/B**: Удаление меток
- **Ctrl+↑/↓**: Изменение BPM
- **Ctrl+G**: Переключение питч-сетки
- **Ctrl+Z**: Отмена последнего действия
- **Ctrl+Y**: Повтор отмененного действия

#### Контекстные меню
- **Правый клик**: Контекстные меню для различных элементов
- **Drag & Drop**: Перетаскивание файлов
- **Колесико мыши**: Масштабирование

### Элементы управления

#### Основные кнопки
- **Play**: Воспроизведение
- **Stop**: Остановка
- **Load**: Загрузка файла
- **Save**: Сохранение результатов

#### Настройки
- **BPM**: Поле ввода BPM
- **Размер такта**: Настройка размера такта
- **Метроном**: Включение/выключение метронома
- **Цветовая схема**: Переключение тем

## Система команд

### Command Pattern

#### AudioCommand
- Загрузка аудиофайлов
- Сохранение результатов
- Валидация форматов
- Обработка ошибок

#### BeatFixCommand
- Исправление отклонений битов
- Интеграция с QUndoStack
- Поддержка отмены/повтора
- Валидация операций

### Управление историей
- **QUndoStack**: Управление историей команд
- **Неограниченная глубина**: История всех операций
- **Валидация**: Проверка возможности отмены
- **Автосохранение**: Автоматическое сохранение состояния

## Настройки и конфигурация

### QSettings

#### Организация настроек
- **Организация**: DONTFLOAT
- **Приложение**: DONTFLOAT
- **Версия**: 1.0.0

#### Сохраняемые параметры
- **BPM трека**: Текущий BPM
- **Настройки метронома**: Громкость, тип звука
- **Режим отображения**: Время или такты
- **Размеры окон**: Позиция и размер окна
- **Элементы интерфейса**: Видимость компонентов
- **Цветовая схема**: Выбранная тема

### Локализация

#### Поддерживаемые языки
- **Русский**: DONTFLOAT_ru_RU.ts
- **Английский**: DONTFLOAT_en_US.ts

#### Переводы
- Все пользовательские тексты через tr()
- Осмысленные контексты
- Поддержка множественных форм
- Использование Qt Linguist

## Производительность

### Оптимизация

#### Отрисовка
- Отрисовка только видимой области
- Агрегация сэмплов при масштабировании
- Кэширование промежуточных вычислений
- Асинхронная обработка

#### Память
- Эффективное управление RAM
- Автоматическая очистка неиспользуемых данных
- Умное кэширование результатов
- Мониторинг использования памяти

### Технические требования

#### Минимальные требования
- **ОС**: Windows 10, macOS 10.14, Linux Ubuntu 18.04
- **RAM**: 4 GB
- **Процессор**: Intel Core i3 или эквивалент
- **Место на диске**: 100 MB

#### Рекомендуемые требования
- **ОС**: Windows 11, macOS 12, Linux Ubuntu 20.04
- **RAM**: 8 GB
- **Процессор**: Intel Core i5 или эквивалент
- **Место на диске**: 500 MB

## Расширения и плагины

### Возможности расширения
- **Плагины анализа**: Дополнительные алгоритмы BPM
- **Форматы аудио**: Поддержка новых форматов
- **Экспорт**: Экспорт результатов в различные форматы
- **Интеграция**: Интеграция с другими приложениями

### API для разработчиков
- **C++ API**: Нативный C++ API
- **Qt API**: Интеграция с Qt приложениями
- **Консольный API**: Командная строка для автоматизации
- **Настройки**: Программная настройка параметров
