# Архитектура DONTFLOAT

## Основные компоненты

### MainWindow
- Главное окно приложения
- Управляет UI элементами и их взаимодействием
- Обрабатывает загрузку аудио через `QMediaPlayer`
- Сохраняет настройки через `QSettings`
- Управляет воспроизведением и отображением времени

### WaveformView
- Визуализация звуковой волны
- Отрисовка тактов и битов
- Масштабирование и навигация
- Обработка пользовательского ввода (мышь, клавиатура)
- Синхронизация с позицией воспроизведения

## Взаимодействие компонентов

### Загрузка аудио
1. `MainWindow` получает путь к файлу
2. `QAudioDecoder` декодирует данные в float-массивы
3. Данные нормализуются и передаются в `WaveformView`
4. `QMediaPlayer` настраивается для воспроизведения

### Навигация
1. Пользователь взаимодействует через:
   - Клики по волне
   - Перетаскивание мышью
   - Скроллбар
   - Клавиши навигации
2. `WaveformView` обновляет смещение и масштаб
3. `MainWindow` синхронизирует позицию воспроизведения

### Масштабирование
1. Управление через колесико мыши или клавиши
2. `WaveformView` обновляет масштаб (1.0 - 1000.0)
3. Скроллбар адаптируется к новому масштабу
4. Сохраняется текущая видимая позиция

## Отображение времени

### Временная шкала
- Поддержка двух режимов:
  1. Время (MM:SS.mmm)
  2. Такты (Bar.Beat.Quarter)
- Переключение через комбобокс
- Обновление в реальном времени

### Визуальные элементы
- Индиго волна с прозрачностью
- Черный курсор воспроизведения
- Белые линии тактов (яркие)
- Белые линии битов (полупрозрачные)
- Темная тема интерфейса

## Технические детали

### Масштабирование и прокрутка
- Масштаб: 1.0 (100%) до 1000.0 (100000%)
- Смещение: 0.0 (начало) до 1.0 (конец)
- Адаптивный размер страницы скроллбара
- Сохранение видимой области при масштабировании

### Обработка аудио
- Поддержка форматов: WAV, MP3, FLAC
- Декодирование в 32-bit float
- Нормализация амплитуды
- Поддержка моно/стерео

### Оптимизация
- Эффективная отрисовка видимой области
- Агрегация сэмплов при масштабировании
- Кэширование промежуточных вычислений
- Плавное обновление интерфейса